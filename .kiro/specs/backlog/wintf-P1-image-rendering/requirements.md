# Requirements Document

| 項目 | 内容 |
|------|------|
| **Document Title** | wintf-image-rendering 要件定義書 |
| **Version** | 0.1 (Draft) |
| **Date** | 2025-11-29 |
| **Parent Spec** | ukagaka-desktop-mascot |
| **Depends On** | wintf-P0-image-widget |
| **Author** | AI-DLC System |

---

## Introduction

本仕様書は wintf フレームワークにおける Image ウィジェットの**描画オプション機能**を定義する。P0（wintf-P0-image-widget）で実装される基本的な画像読み込み・描画機能の上に、高度な描画制御機能を追加する。

### 背景

P0 仕様では、画像を非同期に読み込んでGPUに展開する基本ロジックを完成させる。本P1仕様では、その基盤の上に描画時の表示制御オプションを追加し、より柔軟な画像表示を可能にする。

### スコープ

**含まれるもの**:
- ストレッチモード（None/Fill/Uniform/UniformToFill）
- ソース矩形（画像の一部切り抜き表示）
- 補間モード（NearestNeighbor/Linear）
- Visual変換との連携パターン

**含まれないもの**:
- アニメーション（別途 wintf-P0-animation-system で対応予定）
- 画像フィルター・エフェクト
- 画像の動的生成・編集

### 前提条件

- wintf-P0-image-widget が完了していること
- ImageResource / ImageGraphics コンポーネントが実装されていること

---

## Requirements

### Requirement 1: ストレッチモード

**Objective:** 開発者として、ウィジェットサイズと画像サイズが異なる場合の描画方法を指定したい。それにより様々なレイアウト要件に対応できる。

#### Acceptance Criteria

1. **The** Image widget **shall** 以下のストレッチモードをサポートする:
   - **None**: 元サイズで描画（クリッピングあり）
   - **Fill**: ウィジェットサイズに完全に引き伸ばす（アスペクト比無視）
   - **Uniform**: アスペクト比を維持してウィジェット内に収める（レターボックス）
   - **UniformToFill**: アスペクト比を維持してウィジェット全体を覆う（クロップ）
2. **The** Image widget **shall** デフォルトでUniformモードを使用する
3. **When** ストレッチモードがNoneの場合, **the** Image widget **shall** 画像を中央揃えで配置する
4. **When** ストレッチモードがUniformの場合, **the** Image widget **shall** 余白を透明として描画する

---

### Requirement 2: ソース矩形（切り抜き）

**Objective:** 開発者として、画像の一部分のみを表示したい。それによりスプライトシートや部分的な画像表示が可能になる。

#### Acceptance Criteria

1. **The** Image widget **shall** ソース矩形（srcRect）を指定して画像の一部を切り抜き表示できる
2. **When** ソース矩形が指定されない場合, **the** Image widget **shall** 画像全体を表示する
3. **When** ソース矩形が画像範囲を超える場合, **the** Image widget **shall** クランプして有効範囲のみを使用する
4. **The** ソース矩形 **shall** ピクセル単位で指定される

---

### Requirement 3: 補間モード

**Objective:** 開発者として、画像の拡大・縮小時の補間方法を制御したい。それにより用途に応じた最適な画質を選択できる。

#### Acceptance Criteria

1. **The** Image widget **shall** 以下の補間モードをサポートする:
   - **NearestNeighbor**: ドット絵・ピクセルアート向け（シャープ）
   - **Linear**: 写真・イラスト向け（スムーズ）
2. **The** Image widget **shall** デフォルトでLinearモードを使用する
3. **The** 補間モード **shall** D2D1_BITMAP_INTERPOLATION_MODE で実装される

---

### Requirement 4: Visual変換との連携

**Objective:** 開発者として、D2D描画変換とDirectComposition Visual変換の使い分けを理解したい。それにより適切な変換方法を選択できる。

#### Acceptance Criteria

1. **The** ドキュメント **shall** D2D描画変換（Image widget内）とVisual変換（DirectComposition）の違いを明確にする
2. **The** Image widget **shall** D2D描画変換として以下をサポートする:
   - ストレッチ（本要件で実装）
   - ソース矩形による切り抜き（本要件で実装）
3. **The** Visual変換 **shall** 以下を担当する（Image widget外で制御）:
   - 移動（Translation）
   - 回転（Rotation）
   - スケーリング（Scale）
   - 不透明度（Opacity）
4. **The** 設計 **shall** 両方の変換を組み合わせて使用できる

---

## Non-Functional Requirements

### NFR-1: パフォーマンス

- ストレッチモード変更: フレーム内で即時反映
- 補間モード変更: 再描画のみで完結
- ソース矩形変更: 追加GPU負荷なし

### NFR-2: 互換性

- Direct2D 1.1 以降を使用
- P0 ImageResource/ImageGraphics との後方互換性を維持

---

## Glossary

| 用語 | 説明 |
|------|------|
| ストレッチモード | ウィジェットサイズと画像サイズが異なる場合の描画方法 |
| ソース矩形 | 画像から切り抜く領域を指定する矩形 |
| 補間モード | 画像の拡大・縮小時のピクセル補間アルゴリズム |
| D2D描画変換 | DrawBitmap時に適用される変換（描画内容への影響） |
| Visual変換 | DirectComposition Visualに適用される変換（ウィジェット全体への影響） |

---

## Appendix

### A. 関連ドキュメント

- 前提仕様: `.kiro/specs/wintf-P0-image-widget/`
- 親仕様: `.kiro/specs/ukagaka-desktop-mascot/requirements.md`

---

_Document generated by AI-DLC System on 2025-11-29_
