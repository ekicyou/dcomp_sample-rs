# wintf /wɪn.tɪf/

Windows Tategaki Framework

Windowsにて、日本語による縦書き描画をサポートするために必要な低レベル実装を
提供することを目的とします。

## ロードマップ

### [ ]フェーズ 1: ウィンドウの誕生 🐣
最初の目標は、画面にアプリケーションの「顔」となるウィンドウを表示することです。

- [ ] タスク1.1: プロジェクトのセットアップ
  - Rustプロジェクトを初期化し、`winapi`や`windows`などのクレートを`Cargo.toml`に追加します。
- [ ] タスク1.2: ウィンドウクラスの登録
  - Win32 APIを呼び出して、ウィンドウの基本的な性質を定義するウィンドウクラスを登録します。
- [ ] タスク1.3: ウィンドウの生成
  - 登録したクラスを基に、`CreateWindowExW`を使って実際のウィンドウを画面に表示します。
- [ ] タスク1.4: メッセージループの実装
  - アプリケーションがOSからのメッセージ（イベント）を受け取り、応答できるようにメッセージループを実装します。ウィンドウがフリーズしないようにするための重要なステップです。
- [ ] タスク1.5: ウィンドウとウィンドウスレッドの洗練化
  - `Window`クラス、`WindowBuilder`クラス、`WinThreadMgr`クラスなどを用意し、ウィンドウ生成とメッセージループ処理の役割を洗練します。

🏆小さな報酬: 空っぽのウィンドウが画面に表示され、ドラッグしたり、サイズ変更したり、閉じたりできるようになります。あなたのアプリケーションがはじめて姿を現す瞬間です！

### [ ]フェーズ 2: はじめての描画 🎨
ウィンドウというキャンバスに、色や形を描いてみましょう。

- [ ] タスク2.1: 描画エンジンの初期化
  - `DirectComposition`、`Direct2D`と`DirectWrite`のファクトリオブジェクトを作成し、描画の準備をします。
- [ ] タスク2.2: レンダリングターゲットの作成
  - ウィンドウに描画するための`Direct2D`レンダリングターゲットを作成します。
- [ ] タスク2.3: 簡単な図形の描画
  - 四角形や円などの単純な図形を描画するコードを追加します。

🏆 小さな報酬: ウィンドウに色が付き、図形が描画されます。静的なウィンドウから、動的な表現が可能なキャンバスへと進化します！

### [ ]フェーズ 3: 透過ウィンドウとヒットテスト
ウィンドウを透過し、ヒットテストを実装してマウスクリック反応を実装しましょう。

- [ ] タスク3.1: 透過ウィンドウ対応
  - レイヤードウィンドウ（WS_EX_LAYERED + SetLayeredWindowAttributes）またはDirectCompositionによる透過方式を選定・実装
- [ ] タスク3.2: 論理ツリーとビジュアルツリーの構築
  - 論理ツリー：アプリケーション構造の管理
  - ビジュアルツリー：描画・ヒットテスト用の詳細な階層構造
- [ ] タスク3.3: ビジュアルツリーに対するヒットテスト
  - Z順序や矩形領域など、ヒットテストのアルゴリズムを設計・実装
- [ ] タスク3.4: ウィンドウレベルのヒットテスト
  - `WM_NCHITTEST`でヒットしなければ`HTTRANSPARENT`を返す
  - カスタム領域やシステム領域との兼ね合いも検討

🏆 小さな報酬: ウィンドウの透過と、正確なヒットテストによるインタラクションが実現します！

### [ ]フェーズ 4: 文字との対話（横書き） ✍️
情報を伝えるための基本、テキストを描画します。まずは横書きから。

- [ ] タスク4.1: テキストフォーマットの作成
  - `DirectWrite`を使い、フォント名、サイズ、ウェイトなどを指定してテキストフォーマットを作成します。
- [ ] タスク4.2: テキストの描画
  - 作成したフォーマットを使って、"Hello, World!" のような簡単な文字列をウィンドウに描画します。
- [ ] タスク4.3: ブラシの作成と色の適用
  - `Direct2D`のソリッドカラーブラシを作成し、テキストに色を付けます。

🏆 小さな報酬: ウィンドウ上に指定したフォントと色でテキストが表示されます。アプリケーションがメッセージを伝えられるようになります！

### [ ]フェーズ 5: 画像の表示と透過処理 🖼️
「伺か」には欠かせない、キャラクターなどの画像を表示します。

- [ ] タスク5.1: 画像読み込みの準備
  - `WIC` (Windows Imaging Component) を使って画像ファイルをデコードする準備をします。
- [ ] タスク5.2: 画像の読み込み
  - 透過情報を持つ画像ファイルを読み込み、Direct2Dで扱えるビットマップ形式に変換します。
- [ ] タスク5.3: ビットマップの描画
  - 変換したビットマップをウィンドウの好きな位置に描画します。アルファブレンディングが正しく機能し、背景が透けて見えることを確認します。

🏆 小さな報酬: キャラクターの立ち絵などがきれいに表示されます！これでアプリケーションが一気に華やかになり、「伺か」らしさが出てきます。

### [ ]フェーズ 6: 縦書きの世界へ 📖
このプロジェクトの核心機能、日本語の縦書き描画に挑戦します。

- [ ] タスク6.1: 縦書き用テキストレイアウトの作成
  - `DirectWrite`の`SetReadingDirection`と`SetFlowDirection`を使って、テキストレイアウトを縦書き用に設定します。
- [ ] タスク6.2: 縦書きテキストの描画
  - 縦書き用にレイアウトされたテキストを`DrawTextLayout`で描画します。
- [ ] タスク6.3: 句読点などの調整
  - 句読点や括弧が正しく回転・配置されているか確認します。（`IDWriteTypography`の利用を検討）

🏆 小さな報酬: 日本語の美しい縦書きが実現します！このライブラリのもっとも重要なマイルストーン達成です。

### フェーズ 6: 高度なインタラクション 🖱️
ユーザーからの入力を受け取り、アプリケーションをより対話的にします。

- [ ] タスク6.1: ヒットテストの実装
  - マウスカーソルの座標を取得し、それが特定の領域（キャラクターの頭や体など）の上にあるかを判定するロジックを実装します。
- [ ] タスク6.2: マウスクリックイベントの処理
  - `WM_LBUTTONDOWN`などのメッセージをハンドルし、クリックされた場所に応じて反応を返せるようにします。
- [ ] タスク6.3: IMEサポートの基礎
  - `TSF` (Text Services Framework) の実装に着手します。まずは基本的なテキスト入力と変換ウィンドウの表示を目指します。

🏆 小さな報酬: キャラクターをクリックして反応を返したり、テキスト入力欄で日本語入力ができるようになったりします。アプリケーションに「命」が吹き込まれます。


## 目的

## プロジェクトの目的

### 主目的

- [ ] 「伺か」の最小実装を実現する
- [ ] Windows上で日本語縦書き描画をサポートする低レベル実装の提供
- [ ] ウィンドウの作成と管理
- [ ] ウィンドウメッセージのハンドリング
- [ ] GUIスレッドの初期化とメッセージループの実行
- [ ] 一般的な2D描画および合成処理
- [ ] 透過画像を含むビットマップの扱い
- [ ] 日本語テキスト描画（縦書き・横書き両対応）
- [ ] 高度な日本語IMEサポート（TSFベース）
- [ ] ヒットテスト

### 追加で必要となりそうな構成要素

- [ ] フォント管理とレンダリング
- [ ] テキストレイアウトエンジン（縦書き・横書き切替対応）
- [ ] 入力イベント（キーボード・マウス等）の抽象化
- [ ] DPIスケーリング対応
- [ ] サンプルアプリケーション・デモ
